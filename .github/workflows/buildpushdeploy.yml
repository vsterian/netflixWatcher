name: Build and Push to Raspberry PI

on:
  push:
    branches: main

env:
  #REGISTRY_NAME: <your-acr-registry>  # replace with your ACR name
  SSH_PORT: 30000
  CONTAINER_NAME: netflixwatcher

jobs:
  build-and-push:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
   
    - id: ssh
      uses: invi5H/ssh-action@v1
      with:
        SSH_HOST: ${{ secrets.SSH_SERVER }}
        SSH_PORT: ${{ env.SSH_PORT }}
        SSH_USER: ${{ secrets.SSH_USER }}
        SSH_KEY: ${{ secrets.SSH_PASSWORD }}

    - run: ssh ${{ steps.ssh.outputs.SERVER }} pwd

    - name: Copy Files to Raspberry Pi
      run: |
        scp -r . ${{ env.SSH_USER }}@${{ env.SSH_SERVER }}:/home/${{ env.SSH_USER }}/netflixWatcher

    - name: Run netflixWatcher container

      run: |
         cd /home/${{env.SSH_USER}}/netflixWatcher
         docker compose up -d